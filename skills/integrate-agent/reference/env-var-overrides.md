### Principle

Most well-written agents use env vars for service endpoints. By overriding these in veris.yaml's `agent.environment` section, we redirect traffic without touching source code.

### Docker Networking -> localhost

When docker-compose uses service names as hostnames, override to localhost:

| Original (compose) | Override (veris.yaml) |
|---|---|
| REDIS_HOST=redis | REDIS_HOST=localhost |
| REDIS_URL=redis://redis:6379/0 | REDIS_URL=redis://localhost:6379/0 |
| POSTGRES_HOST=postgres / DATABASE_URL=postgresql://user:pass@postgres:5432/mydb | DATABASE_URL=postgresql://postgres:postgres@localhost:5432/SIMULATION_ID |
| ELASTICSEARCH_URL=http://elasticsearch:9200 | ELASTICSEARCH_URL=http://localhost:9200 |
| AMQP_URL=amqp://guest:guest@rabbitmq:5672 | AMQP_URL=amqp://guest:guest@localhost:5672 |
| KAFKA_BOOTSTRAP_SERVERS=kafka:9092 | KAFKA_BOOTSTRAP_SERVERS=localhost:9092 |
| MINIO_ENDPOINT=minio:9000 | MINIO_ENDPOINT=localhost:9000 |

### Veris Mock Service Credentials

Pre-fill mock credentials in veris.yaml for mocked services:

**Salesforce (crm):**
- SALESFORCE_DOMAIN=mock-salesforce
- SALESFORCE_USERNAME=mock_user@simulation.test
- SALESFORCE_CONSUMER_KEY=mock_consumer_key_12345
- SALESFORCE_CONSUMER_SECRET=mock_consumer_secret_67890

**Google Calendar:**
- GOOGLE_APPLICATION_CREDENTIALS=/certs/mock-service-account.json (auto-generated by veris)

**Slack:**
- SLACK_BOT_TOKEN=xoxb-mock-token-for-veris-simulation
- SLACK_SIGNING_SECRET=mock-signing-secret

**Jira:**
- No special credentials -- DNS interception handles it. Agent's existing JIRA_URL (like https://mysite.atlassian.net) works transparently.

**Postgres:**
- DATABASE_URL=postgresql://postgres:{POSTGRES_PASSWORD}@localhost:5432/SIMULATION_ID

### LLM Providers (Automatic)

Veris LLM proxy intercepts all calls to OpenAI, Anthropic, Azure OpenAI, Google AI, etc. automatically.
- OPENAI_API_KEY: keep the real key (passed through proxy to real API)
- ANTHROPIC_API_KEY: same
- AZURE_OPENAI_ENDPOINT: keep as-is (DNS intercepted)
- No changes needed. No veris.yaml service entry needed.

### Making Services Optional

When agent imports a service SDK but the service isn't critical:
- Set disable flags: DD_TRACE_ENABLED=false, NEW_RELIC_ENABLED=false, SENTRY_DSN=""
- Set dummy endpoints: SPLUNK_HEC_URL=http://localhost:1/dev/null, DATADOG_API_KEY=""
- If agent startup has try/except around service init, it degrades gracefully
- If agent crashes without the service, it MUST be mocked/bundled/external -- can't just disable

### AWS SDK Overrides (for LocalStack or MinIO)

- AWS_ENDPOINT_URL=http://localhost:4566 (LocalStack) or http://localhost:9000 (MinIO for S3 only)
- AWS_ACCESS_KEY_ID=test
- AWS_SECRET_ACCESS_KEY=test
- AWS_DEFAULT_REGION=us-east-1

### Special Values in veris.yaml

- `${VAR_NAME}` -- expanded from container env (e.g., `${OPENAI_API_KEY}` reads from .env.simulation)
- `SIMULATION_ID` -- replaced with actual simulation ID at runtime (use in DB names: `postgresql://...@localhost:5432/SIMULATION_ID`)
